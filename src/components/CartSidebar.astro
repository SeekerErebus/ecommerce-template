---
---

<!-- Cart Overlay -->
<div
  id="cart-overlay"
  class="fixed inset-0 bg-black/40 z-50 hidden transition-opacity"
></div>

<!-- Cart Sidebar -->
<aside
  id="cart-sidebar"
  class="fixed top-0 right-0 w-full max-w-md h-full bg-warm-white shadow-2xl z-50 transform translate-x-full transition-transform duration-300 ease-out flex flex-col"
>
  <!-- Header -->
  <div class="flex items-center justify-between px-6 py-5 border-b border-thread-200">
    <h2 class="font-serif text-xl font-bold text-charcoal">Your Cart</h2>
    <button
      id="cart-close"
      class="flex items-center justify-center w-8 h-8 rounded-full text-thread-500 hover:text-charcoal hover:bg-thread-100 transition-colors"
      aria-label="Close cart"
    >
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <!-- Cart Items -->
  <div id="cart-items" class="flex-1 overflow-y-auto px-6 py-4">
    <!-- Empty state -->
    <div id="cart-empty" class="flex flex-col items-center justify-center h-full text-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-thread-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 0 1-1.12-1.243l1.264-12A1.125 1.125 0 0 1 5.513 7.5h12.974c.576 0 1.059.435 1.119 1.007ZM8.625 10.5a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm7.5 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
      </svg>
      <p class="text-thread-500 font-medium">Your cart is empty</p>
      <p class="text-sm text-thread-400 mt-1">Add some beautiful items to get started.</p>
    </div>
    <!-- Populated items rendered by JS -->
  </div>

  <!-- Footer -->
  <div id="cart-footer" class="hidden border-t border-thread-200 px-6 py-5 space-y-4">
    <div class="flex items-center justify-between">
      <span class="text-sm font-medium text-thread-600">Subtotal</span>
      <span id="cart-total" class="text-lg font-bold text-charcoal">$0</span>
    </div>
    <p class="text-xs text-thread-400">Shipping and taxes calculated at checkout.</p>
    <button class="w-full py-3 bg-ember-600 hover:bg-ember-700 text-white font-semibold rounded-lg transition-colors">
      Checkout
    </button>
    <button
      id="cart-continue"
      class="w-full py-2 text-sm font-medium text-thread-600 hover:text-ember-600 transition-colors"
    >
      Continue Shopping
    </button>
  </div>
</aside>

<script>
  const sidebar = document.getElementById('cart-sidebar');
  const overlay = document.getElementById('cart-overlay');
  const closeBtn = document.getElementById('cart-close');
  const continueBtn = document.getElementById('cart-continue');
  const itemsContainer = document.getElementById('cart-items');
  const emptyState = document.getElementById('cart-empty');
  const footer = document.getElementById('cart-footer');
  const totalEl = document.getElementById('cart-total');

  function closeCart() {
    sidebar?.classList.add('translate-x-full');
    overlay?.classList.add('hidden');
  }

  closeBtn?.addEventListener('click', closeCart);
  continueBtn?.addEventListener('click', closeCart);
  overlay?.addEventListener('click', closeCart);

  function renderCart() {
    if (!window.emberCart || !itemsContainer) return;

    const items = window.emberCart.items;

    if (items.length === 0) {
      emptyState?.classList.remove('hidden');
      footer?.classList.add('hidden');
      // Remove all item elements
      itemsContainer.querySelectorAll('.cart-item').forEach((el) => el.remove());
      return;
    }

    emptyState?.classList.add('hidden');
    footer?.classList.remove('hidden');

    // Remove old items
    itemsContainer.querySelectorAll('.cart-item').forEach((el) => el.remove());

    items.forEach((item) => {
      const el = document.createElement('div');
      el.className =
        'cart-item flex gap-4 py-4 border-b border-thread-100 last:border-0';
      el.innerHTML = `
        <img src="${item.image}" alt="${item.name}" class="w-20 h-20 object-cover rounded-lg bg-thread-100" />
        <div class="flex-1 min-w-0">
          <h4 class="text-sm font-semibold text-charcoal truncate">${item.name}</h4>
          <p class="text-sm font-bold text-charcoal mt-0.5">$${item.price}</p>
          <div class="flex items-center gap-2 mt-2">
            <button class="qty-btn w-7 h-7 flex items-center justify-center rounded border border-thread-200 text-thread-600 hover:border-ember-400 hover:text-ember-600 transition-colors text-xs" data-action="decrease" data-id="${item.id}">-</button>
            <span class="text-sm font-medium text-charcoal w-6 text-center">${item.quantity}</span>
            <button class="qty-btn w-7 h-7 flex items-center justify-center rounded border border-thread-200 text-thread-600 hover:border-ember-400 hover:text-ember-600 transition-colors text-xs" data-action="increase" data-id="${item.id}">+</button>
          </div>
        </div>
        <button class="remove-btn self-start text-thread-400 hover:text-red-500 transition-colors p-1" data-id="${item.id}" aria-label="Remove item">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
        </button>
      `;
      itemsContainer.appendChild(el);
    });

    // Bind quantity buttons
    itemsContainer.querySelectorAll('.qty-btn').forEach((btn) => {
      btn.addEventListener('click', (e) => {
        const target = e.currentTarget as HTMLElement;
        const id = target.dataset.id;
        const action = target.dataset.action;
        const item = window.emberCart.items.find((i) => i.id === id);
        if (!item) return;
        const newQty =
          action === 'increase' ? item.quantity + 1 : item.quantity - 1;
        window.emberCart.updateQuantity(id, newQty);
      });
    });

    // Bind remove buttons
    itemsContainer.querySelectorAll('.remove-btn').forEach((btn) => {
      btn.addEventListener('click', (e) => {
        const target = e.currentTarget as HTMLElement;
        window.emberCart.remove(target.dataset.id);
      });
    });

    // Update total
    if (totalEl) {
      totalEl.textContent = `$${window.emberCart.getTotal()}`;
    }
  }

  window.addEventListener('cart-updated', renderCart);
  renderCart();
</script>
